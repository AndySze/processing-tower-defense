<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/2001/REC-xhtml11-20010531/DTD/xhtml11-flat.dtd">
<!-- <!DOCTYPE XHTML 1.1> -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>SVG Tower Defense</title>
<link href="style.css" media="screen" rel="Stylesheet" type="text/css" />        

</head>
<body>

<h1>SVG Tower Defense</h1>

    <svg id='tower_defense' width="600" height="400" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
      
      <defs>
        <rect id='grid_square' width='25' height='25'/>
        
        <symbol id='creep'>
          <circle cx='50%' cy='50%' r='50%'/>
        </symbol>
      </defs>
      
      <rect id='background' width='100%' height='100%' />
      <g id='grid_layer'/>
      <g id='creep_layer'>
      </g>
      <use xlink:href='#creep' x='10' y='315' width='20' height='20' >
        <animate attributeName="x" attributeType="XML" begin="0s" dur="3s" fill="freeze" to="300" />
      </use>
      
    </svg>

<button onclick='remove_grid()'>Remove Grid</button>
<div id='log'/>  
<script src="jquery-1.2.6.min.js" type="text/javascript" charset="utf-8" />
<script src="game/util.js" type="text/javascript" charset="utf-8"/>
<script src="jsvg.js" type="text/javascript" charset="utf-8"/>
<script type="text/javascript"><![CDATA[
    var GridSquare = function(x,y, opts) {
      opts = opts || {}
      opts.x = x; opts.y = y;
      return CreateKind("grid_square", opts);
    }
    var Creep = function(x,y, diameter) {
      return CreateKind("creep", {x:x, y:y, width:diameter, height:diameter});
    }
    
    var stage = $('svg');
    var width = stage[0].width.baseVal.value; 
    var height = stage[0].height.baseVal.value;
    var units_per_square = $('#grid_square')[0].width.baseVal.value;
    $(document).ready(function(){
      var grid = $('#grid_layer');
      //create grid of squares
      for (var y = 0; y < height + units_per_square + 1; y += units_per_square + 1)
        for (var x = 0; x < width + units_per_square + 1; x += units_per_square + 1){
          opts = {};
          if (random(1) > 0.5)
            opts['class'] = "mountain-terrain";

          gs = GridSquare(x,y,opts);

//           gs[0].setAttributeNS("http://www.w3.org/TR/2001/REC-xhtml11-20010531/DTD/xhtml11-flat.dtd", 'class', 'mountain-terrain')
          grid.append(gs);
        }
          
      

      var creep = Creep(10,100, 10);
      $('#creep_layer').append(creep)
      run();
    });
    
    var remove_grid = function(){
      $('#grid_layer').empty();
    }
    
    var i = 0;
    var draw = function(){
      // $("#creep_layer > *").each(function() {
//         this.setAttribute("x", this.x.baseVal.value + 2);
//         if (this.x.baseVal.value > width) 
//           $(this).remove();
//       })
    }
    
    var interval = undefined;
    var run = function() {
      $("#creep_layer > *").each(function() {
        var s = SVGObj("animate", {attributeName:"x", attributeType:"XML", fill:"freeze", to:width, begin:"0s", dur:"5s"});
        $(this).append(s);
      })
//       <animate attributeType="CSS" attributeName="opacity" from="1" to="0" dur="5s" repeatCount="indefinite" />
      interval = setInterval(function() {
        draw();
      }, 10);
    }
    var pause = function() {
      clearInterval(interval);
    }
]]></script> 


</body></html>
