<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>Processed Tower Defense</title>
<script type="text/javascript" charset="utf-8" src="processing.js"></script>
<script type="text/javascript" charset="utf-8" src="jsfprocessing.js"></script>
<script type="text/javascript" charset="utf-8" src="jquery-1.2.6.min.js"></script>
<script type="text/javascript" charset="utf-8" src="ptd.js"></script>

<link href="style.css" media="screen" rel="Stylesheet" type="text/css" />        

</head>

<body>
<h1> Processed Tower Defense </h1>

<div id="game_over"></div>

<div id="game">
<div id="top_controls">
  <span> Lives: <span id="lives">20</span></span>
  <span> Score: <span id="score">0</span></span>
  <span> Gold: <span id="gold">0</span></span>
  <span> Wave: <span id="wave">1</span></span>
  <span> Creep Variety: <span id="creep_variety"></span></span>
</div>

<div id="middle">
<canvas id="tower_defense" width="600" height="400"></canvas>

<div id="side">
<div id="controls">
  <table>
    <tr>
      <td> <button onclick="build_laser_tower();" accesskey="L">Build <u>L</u>aser Tower</button> </td>
      <td> 50 Gold </td>
    </tr>
    <tr> <td> Fast, ok range, low damage. </td> </tr>
    <tr>
      <td> <button onclick="build_missile_tower();" accesskey="M">Build <u>M</u>issile Tower</button> </td>
      <td> 100 Gold </td>
    </tr>
    <tr> <td> Slow, long range, high damage. </td></tr>

    <tr>  
      <td> <button onclick="aim_missile();" accesskey="S">Launch <u>S</u>mall Missile</button></td>
      <td> 50 Gold </td>
    </tr>
    <tr><td> Reduce creeps by 50% of current health. </td></tr>
    <tr>
      <td> <button onclick="nuke_creeps();" accesskey="N"> Launch <u>N</u>uke </button></td>
      <td id="nukes_left"> 3 left </td>
    </tr>
    <tr><td> Kill everything, but no loot. </td></tr>
    <tr><td><div class='error'></div></td></tr>
    <tr><td><div class='message'></div></td></tr>
  </table>
</div>

<div id="tower">
  <table>
    <tr><td></td><td> <em>Tower Details</em> </td></tr>
    <tr><td> Type: </td><td id="tower_type"></td></tr>
    <tr><td> Range: </td><td id="tower_range"></tr>
    <tr><td> Damage: </td><td id="tower_damage"></tr>
    <tr><td> Firing Rate: </td><td id="tower_rate"></tr>
    <tr><td><button id="tower_sell_button"></button></td></tr>
    <tr><td><button id="tower_upgrade_button"><u>U</u>pgrade!</button></td></tr>
  </table>  
</div>
<div id="creep"></div>
</div>
</div>

<div id="bottom_controls">
  <button id='pause_button' onclick="pause();">Pause</button>
  <button onclick="reset_game();">Reset Game</button>
  <button onclick="spawn_wave();">Spawn Next <u>W</u>ave</button>
  </div>
</div>

<h4>Hotkeys:</h4>
<ul>
    <li>L – Build laser tower</li>
    <li>M – Build missile tower</li>
    <li>S – Fire Small Missile</li>
    <li>N – Launch Nuke</li>
    <li>W – Spawn Next Wave</li>
    <li>U – Upgrade Selected Tower</li>
    <li>[space] – Pause/Resume</li>
    <li>[esc] – Cancel Tower/Missile</li>
</ul>

<h4>Source:</h4>
<ul>
  <li> <a href="ptd.js">ptd.js</a> </li>
  <li> <a href="jsfprocessing.js">jsfprocessing.js</a> </li>
  <li> <a href="http://ejohn.org/blog/processingjs/">Processing.js</a> </li>
</ul>


<script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        start_tower_defense();
    })  
    
    $("body").bind("keydown", function(e) {
        // if the user is holding down ctrl or cmd, let the browser handle it
        if (e.metaKey) return true;
        
        switch(e.keyCode){
          case 76: build_laser_tower(); break;
          case 77: build_missile_tower(); break;
          case 83: aim_missile(); break;
          case 78: nuke_creeps(); break;
          case 32: pause(); break;
          case 27: unselect(); break;
          case 87: spawn_wave(); break;
          case 85: $('#tower_upgrade_button').click(); break;
          default: return true;
        }
        // if we handled the key press, return false
        return false;
    });
    var paused = false;
    function pause() {
        paused = !paused;
        pause_resume();
        $('#pause_button').html(paused ? "Resume" : "Pause");
    }
    
    //Temporary messages are a bit of a pain
    var timeToHide = null;
    ["error","message"].forEach(function(s){
        $('.'+s).hide();
        $('').bind(s,function(e,message){
            timeToHide = new Date().getTime() + 2500;
            var el = $('.'+s);
            el.html(message).fadeIn();
            window.setTimeout(function() {
                if (new Date().getTime() >= timeToHide)
                    el.fadeOut();
            }, 3000);
        });
    });
    $('#game_over').hide();
    $('').bind('game_over', function(e,hide){
        if (hide == true)
            $('#game_over').html("Game Over! Final score: " + $("#score").html()).fadeIn();
        else
            $('#game_over').html("Just once more...").fadeOut();
    })
</script>

<hr>
<p><a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 License</a>, by <a href="http://lethain.com">Will Larson</a> </p>

</body> </html>
