<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/2001/REC-xhtml11-20010531/DTD/xhtml11-flat.dtd">
<!-- <!DOCTYPE XHTML 1.1> -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>Processed Tower Defense</title>
<link href="style.css" media="screen" rel="Stylesheet" type="text/css" />        

</head>

<body>
<h1> Processed Tower Defense </h1>

<div id="game_over"></div>

<div id="game">
  <div id="top_controls">
    <span class='item'> Lives: <span id="lives">20</span></span>
    <span class='item'> Score: <span id="score">0</span></span>
    <span class='item'> Gold: <span id="gold">0</span></span>
    <span class='item'> Wave: <span id="wave">1</span></span>
    <span class='item'> Creep Variety: <span id="creep_variety"></span></span>
    <span class='item'> Next Wave in <span id="till_next_wave"></span> seconds</span>
  </div>

  <div id="middle">
    <canvas id='tower_defense' width="600" height="400"></canvas>

    <div id="side">
      <div id="controls">
        <table>
          <tr>
            <td> <button id='laser_button' onclick="build_laser_tower();" accesskey="L">Build <span class='hotkey'>L</span>aser Tower - 50 Gold</button> </td>
          </tr>
          <tr>
            <td> <button id='gattling_button' onclick="build_gattling_tower();"> Build <span class='hotkey'>G</span>attling Tower - 50 Gold</button></td>
          </tr>
    
          <tr>
            <td> <button id='missile_button' onclick="build_missile_tower();" accesskey="M">Build <span class='hotkey'>M</span>issile Tower - 100 Gold</button> </td>
          </tr>
          <tr>
            <td> <button id='cannon_button' onclick="build_cannon_tower();" accesskey="M">Build <span class='hotkey'>C</span>annon Tower - 100 Gold</button> </td>
          </tr>
          <tr>  
            <td> <button id='bomb_button' onclick="aim_bomb();" accesskey="S">Drop <span class='hotkey'>B</span>omb - 50 Gold</button></td>
          </tr>
          <tr>
            <td> <button onclick="nuke_creeps();" accesskey="N"> Launch <span class='hotkey'>N</span>uke - <span id="nukes_left"> 3 left </span></button></td>
          </tr>
          <tr><td><div class='error'></div></td></tr>
          <tr><td><div class='message'></div></td></tr>
        </table>
      </div>

      <div id="tower">
        <table>
          <tr><td></td><td> <em>Tower Details</em> </td></tr>
          <tr><td> Type: </td><td id="tower_type"></td></tr>
          <tr><td> Range: </td><td id="tower_range"></td></tr>
          <tr><td> Damage: </td><td id="tower_damage"></td></tr>
          <tr><td> Firing Rate: </td><td id="tower_rate"></td></tr>
          <tr><td><button id="tower_sell_button"></button></td></tr>
          <tr><td><button id="tower_upgrade_button"><span class='hotkey'>U</span>pgrade!</button></td></tr>
        </table>  
      </div>
      <div id="creep">
        <table>
          <tr><td></td><td> <em> Creep Details </em></td></tr>
          <tr><td> Type: </td><td id="creep_type"></td></tr>
          <tr><td> Hp: </td><td id="creep_hp"></td></tr>
          <tr><td> Value: </td><td id="creep_value"></td></tr>
        </table>
      </div>
    </div>
  </div>

  <div id="bottom_controls">
    <button id='pause_button' onclick="pause();">Pause</button>
    <button onclick="reset_game();">Reset Game</button>
    <button onclick="spawn_wave();">Spawn Next <span class='hotkey'>W</span>ave</button>
    <button id='mute_button' onclick="mute();">Mute</button>
  </div>
</div>

<h4>Hotkeys:</h4>
<ul>
    <li>L – Build laser tower</li>
    <li>M – Build missile tower</li>
    <li>G – Build gattling tower</li>
    <li>C – Build cannon tower</li>
    <li>B – Drop Bomb</li>
    <li>N – Launch Nuke</li>
    <li>W – Spawn Next Wave</li>
    <li>U – Upgrade Selected Tower</li>
    <li>[space] – Pause/Resume</li>
    <li>[esc] – Cancel Tower/Missile</li>
</ul>

<h4>Source:</h4>
<ul>
  <li> <a href="http://github.com/rictic/processing-tower-defense/">Repository</a> </li>
  <li> <a href="http://rictic.lighthouseapp.com/projects/11911/home">Wiki and Issue Tracker</a> </li>
  <li> <a href="ptd.js">ptd.js</a> </li>
  <li> <a href="jsfprocessing.js">jsfprocessing.js</a> </li>
  <li> <a href="http://ejohn.org/blog/processingjs/">Processing.js</a> </li>
</ul>


<div id="js_imports">
<!-- Putting script elements as late in the document as possible gives
    a better, faster initial render. -->
<script src="processing.js" type="text/javascript" charset="utf-8" ></script>
<script src="jsfprocessing.js" type="text/javascript" charset="utf-8" ></script>
<script src="jquery-1.2.6.min.js" type="text/javascript" charset="utf-8" ></script>
<script src="game/creep_waves.js" type="text/javascript" charset="utf-8" ></script>
<script src="game/terrain.js" type="text/javascript" charset="utf-8" ></script>
<script src="game/util.js" type="text/javascript" charset="utf-8" ></script>
<script src="game/creeps.js" type="text/javascript" charset="utf-8" ></script>
<script src="game/ui_modes.js" type="text/javascript" charset="utf-8" ></script>
<script src="game/weapons.js" type="text/javascript" charset="utf-8" ></script>
<script src="game/ptd.js" type="text/javascript" charset="utf-8" ></script>
</div>

<script type="text/javascript" charset="utf-8">
    /* initialization */
    $(document).ready(function() {
        start_tower_defense();
    })
    
    
    /* Hotkeys! */
    special_keys = {
        27: 'esc', 9: 'tab', 32:'space', 13: 'return', 8:'backspace', 145: 'scroll', 20: 'capslock', 
        144: 'numlock', 19:'pause', 45:'insert', 36:'home', 46:'del',35:'end', 33: 'pageup', 
        34:'pagedown', 37:'left', 38:'up', 39:'right',40:'down', 112:'f1',113:'f2', 114:'f3', 
        115:'f4', 116:'f5', 117:'f6', 118:'f7', 119:'f8', 120:'f9', 121:'f10', 122:'f11', 123:'f12'};
    
    //extract hotkeys from the DOM
    var hotkeys = {};
    $('button .hotkey').each(function(){
        //this is bass ackwards, but I got type errors passing around the native click method
        var button = this.parentNode;
        hotkeys[this.innerHTML] = function() {button.click()};
    });
    
    //hotkeys that aren't in the dom
    hotkeys["space"] = pause;
    hotkeys["esc"] = unselect;

    $(document).bind("keydown", function(e) {
        // if the user is holding down ctrl or cmd, let the browser handle it
        if (e.metaKey) return true;
        
        var key = special_keys[e.keyCode] || String.fromCharCode(e.keyCode);
        if (key in hotkeys){
            hotkeys[key]();
            return false
        }
        return true
    });
    
    var paused = false;
    function pause() {
        paused = !paused;
        pause_resume();
        $('#pause_button').html(paused ? "Resume" : "Pause");
    }
    function mute() {
        mute_unmute();
        $('#mute_button').html(muted ? "Unmute" : "Mute");
    }
    
    /* Messages for the player */

    //Temporary messages are a bit of a pain
    var timeToHide = null;
    ["error","message"].forEach(function(s){
        $('.'+s).hide();
        $('').bind(s,function(e,message){
            timeToHide = new Date().getTime() + 2500;
            var el = $('.'+s);
            el.html(message).fadeIn();
            window.setTimeout(function() {
                if (new Date().getTime() >= timeToHide)
                    el.fadeOut();
            }, 3000);
        });
    });
    $('#game_over').hide();
    $('').bind('game_over', function(e,hide){
        if (hide == true)
            $('#game_over').html("Game Over! Final score: " + $("#score").html()).fadeIn();
        else
            $('#game_over').html("Just once more...").fadeOut();
    });


    /* illustrating to the user what mode they're in*/
    mode_signifiers = {'BuildLaserTowerMode':'laser_button', 'BuildGattlingTowerMode':'gattling_button',
                       'BuildCannonTowerMode':'cannon_button', 'BuildMissileTowerMode':'missile_button',
                       'AimBombMode':'bomb_button', 'PauseMode':'pause_button'};
    for (event in mode_signifiers) {
        $('').bind(event, function(e) {
            $('#'+mode_signifiers[e.type]).addClass('active_mode');
        });
    }
    $('').bind('no_mode', function() {
        $('button').removeClass('active_mode');
    })
    
    /* stub until we pull in sound for reals */
    var play_sound = function(){};
</script>

<hr/>
<p><a rel="license" href="http://www.opensource.org/licenses/mit-license.php">MIT License</a>, by <a href="http://lethain.com">Will Larson</a> and <a href="http://blog.rictic.com/">Peter Burns</a></p>
<!-- <p>Sound effects are released under a <a href='http://creativecommons.org/licenses/sampling+/1.0/'>Creative Commons Sampling Plus 1.0 License</a> - For authorship information, see <a href='assets/LICENSE'>here</a></p> -->
<div id="log"></div>
<div id="sfx_dump"></div>
</body> </html>
